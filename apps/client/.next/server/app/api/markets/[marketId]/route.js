(()=>{var e={};e.id=705,e.ids=[705],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4472:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>v,routeModule:()=>l,serverHooks:()=>y,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{GET:()=>d});var i=s(48106),n=s(48819),a=s(12050),o=s(10368),u=s(45751),c=s(55511),p=s(4235);async function d(e,{params:t}){let s=(await t).marketId;if(console.log(s+"mrrr"),s.startsWith("search-")){let e=s.split("search-")[1],t=u.mk.safeParse({query:e});if(!t.success)return p.NextResponse.json({message:t.error.message,success:!1});let r=o.z.getInstance();await r.init();let i=(0,c.randomUUID)(),n=r.subscribeToEvent(i);await r.pushToEngine({query:e},"QUERY_SEARCH",i);let a=await n;return p.NextResponse.json(a)}let r=u.m0.safeParse({marketId:s});if(!r.success)return p.NextResponse.json({message:r.error.message,success:!1});let i=o.z.getInstance();await i.init();let n=(0,c.randomUUID)(),a=i.subscribeToEvent(n);await i.pushToEngine({marketId:s},"GET_MARKET_ORDERBOOK",n);let d=await a;return p.NextResponse.json(d)}let l=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/markets/[marketId]/route",pathname:"/api/markets/[marketId]",filename:"route",bundlePath:"app/api/markets/[marketId]/route"},resolvedPagePath:"/Users/divakarjaiswal/Developer/opinion/apps/client/app/api/markets/[marketId]/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:y}=l;function v(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},10368:(e,t,s)=>{"use strict";s.d(t,{z:()=>n});var r=s(17097),i=s(55511);class n{constructor(){this.client=(0,r.createClient)({url:process.env.REDIS_URL}),this.pubsubclient=this.client.duplicate()}async init(){this.client.isOpen||await this.client.connect(),this.pubsubclient.isOpen||await this.pubsubclient.connect(),console.log("Both clients are connected")}static getInstance(){return n.instance||(n.instance=new n),n.instance}async pushToEngine(e,t,s){let r=(0,i.randomUUID)();return await this.client.lPush("order.queue",JSON.stringify({type:t,eventId:s||r,payload:e})),console.log("pushed to engine"),r}async subscribeToEvent(e){return new Promise(async(t,s)=>{let r=setTimeout(async()=>{console.log("timeout called"),await this.pubsubclient.unsubscribe(e),s({message:"no response"})},5e3);await this.pubsubclient.subscribe(e,s=>{clearTimeout(r);let i=JSON.parse(s);this.pubsubclient.unsubscribe(e),t(i)})})}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41692:e=>{"use strict";e.exports=require("node:tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45751:(e,t,s)=>{"use strict";s.d(t,{_o:()=>o,m0:()=>n,mk:()=>a,td:()=>i});var r=s(83217);let i=r.Ay$.object({userId:r.Ay$.string({message:"Invalid User Id."}),ticket_type:r.Ay$.enum(["YES","NO"],{message:"Invalid Ticket Type Provided."}),order_type:r.Ay$.enum(["BUY","SELL"],{message:"Invaid Order Type Provided."}),quantity:r.Ay$.number().int().positive({message:"Invalid quantity provided."}),price:r.Ay$.float32().positive().min(.5).max(9.5,{message:"Invalid Price"}),marketId:r.Ay$.string({message:"Event Id not specificed"})}),n=r.Ay$.object({marketId:r.Ay$.string().min(6).max(50,{message:"Invalid Market ID Admin sensei"}),title:r.Ay$.string().optional(),description:r.Ay$.string().optional()}),a=r.Ay$.object({query:r.Ay$.string({message:"Not valid query for searching markets"})});r.Ay$.object({userId:r.Ay$.string().min(4).max(15,{message:"Invalid user Id"})});let o=r.Ay$.object({marketId:r.Ay$.string(),winner:r.Ay$.enum(["YES","NO"])})},55511:e=>{"use strict";e.exports=require("crypto")},58500:e=>{"use strict";e.exports=require("node:timers/promises")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73136:e=>{"use strict";e.exports=require("node:url")},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},80408:()=>{},87032:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[986,97,217,744],()=>s(4472));module.exports=r})();