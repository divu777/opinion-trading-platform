(()=>{var e={};e.id=637,e.ids=[637],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10368:(e,t,s)=>{"use strict";s.d(t,{z:()=>i});var r=s(17097),n=s(55511);class i{constructor(){this.client=(0,r.createClient)({url:process.env.REDIS_URL}),this.pubsubclient=this.client.duplicate()}async init(){this.client.isOpen||await this.client.connect(),this.pubsubclient.isOpen||await this.pubsubclient.connect(),console.log("Both clients are connected")}static getInstance(){return i.instance||(i.instance=new i),i.instance}async pushToEngine(e,t,s){let r=(0,n.randomUUID)();return await this.client.lPush("order.queue",JSON.stringify({type:t,eventId:s||r,payload:e})),console.log("pushed to engine"),r}async subscribeToEvent(e){return new Promise(async(t,s)=>{let r=setTimeout(async()=>{console.log("timeout called"),await this.pubsubclient.unsubscribe(e),s({message:"no response"})},5e3);await this.pubsubclient.subscribe(e,s=>{clearTimeout(r);let n=JSON.parse(s);this.pubsubclient.unsubscribe(e),t(n)})})}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29434:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>x,routeModule:()=>m,serverHooks:()=>v,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>y});var r={};s.r(r),s.d(r,{GET:()=>l,POST:()=>d});var n=s(48106),i=s(48819),a=s(12050),o=s(10368),c=s(45751),u=s(55511),p=s(4235);let l=async e=>{try{let e=o.z.getInstance();await e.init();let t=(0,u.randomUUID)(),s=e.subscribeToEvent(t);await e.pushToEngine({},"GET_ALL_MARKETS",t);let r=await s;return p.NextResponse.json(r)}catch(e){return console.log("error in getting all markets "+JSON.stringify(e)),p.NextResponse.json({message:e,success:!1,markets:[]})}};async function d(e){try{console.log("heere");let t=await e.json();console.log(JSON.stringify(t));let s=c.m0.safeParse(t);if(!s.success)return p.NextResponse.json({message:s.error.message,success:!1});let r=o.z.getInstance();await r.init();let n=(0,u.randomUUID)(),i=r.subscribeToEvent(n);await r.pushToEngine(t,"CREATE_MARKET",n);let a=await i;return p.NextResponse.json(a)}catch(e){return console.log("error in creating market"+e),p.NextResponse.json({message:"Error in creating new market admin san",success:!1})}}let m=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/markets/route",pathname:"/api/markets",filename:"route",bundlePath:"app/api/markets/route"},resolvedPagePath:"/Users/divakarjaiswal/Developer/opinion/apps/client/app/api/markets/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:g,workUnitAsyncStorage:y,serverHooks:v}=m;function x(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:y})}},41692:e=>{"use strict";e.exports=require("node:tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45751:(e,t,s)=>{"use strict";s.d(t,{_o:()=>o,m0:()=>i,mk:()=>a,td:()=>n});var r=s(83217);let n=r.Ay$.object({userId:r.Ay$.string({message:"Invalid User Id."}),ticket_type:r.Ay$.enum(["YES","NO"],{message:"Invalid Ticket Type Provided."}),order_type:r.Ay$.enum(["BUY","SELL"],{message:"Invaid Order Type Provided."}),quantity:r.Ay$.number().int().positive({message:"Invalid quantity provided."}),price:r.Ay$.float32().positive().min(.5).max(9.5,{message:"Invalid Price"}),marketId:r.Ay$.string({message:"Event Id not specificed"})}),i=r.Ay$.object({marketId:r.Ay$.string().min(6).max(50,{message:"Invalid Market ID Admin sensei"}),title:r.Ay$.string().optional(),description:r.Ay$.string().optional()}),a=r.Ay$.object({query:r.Ay$.string({message:"Not valid query for searching markets"})});r.Ay$.object({userId:r.Ay$.string().min(4).max(15,{message:"Invalid user Id"})});let o=r.Ay$.object({marketId:r.Ay$.string(),winner:r.Ay$.enum(["YES","NO"])})},55511:e=>{"use strict";e.exports=require("crypto")},58500:e=>{"use strict";e.exports=require("node:timers/promises")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73136:e=>{"use strict";e.exports=require("node:url")},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},80408:()=>{},87032:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[986,97,217,744],()=>s(29434));module.exports=r})();