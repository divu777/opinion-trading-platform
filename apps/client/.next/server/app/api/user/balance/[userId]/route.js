(()=>{var e={};e.id=723,e.ids=[723],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10368:(e,t,s)=>{"use strict";s.d(t,{z:()=>i});var r=s(17097),n=s(55511);class i{constructor(){this.client=(0,r.createClient)({url:process.env.REDIS_URL}),this.pubsubclient=this.client.duplicate()}async init(){this.client.isOpen||await this.client.connect(),this.pubsubclient.isOpen||await this.pubsubclient.connect(),console.log("Both clients are connected")}static getInstance(){return i.instance||(i.instance=new i),i.instance}async pushToEngine(e,t,s){let r=(0,n.randomUUID)();return await this.client.lPush("order.queue",JSON.stringify({type:t,eventId:s||r,payload:e})),console.log("pushed to engine"),r}async subscribeToEvent(e){return new Promise(async(t,s)=>{let r=setTimeout(async()=>{console.log("timeout called"),await this.pubsubclient.unsubscribe(e),s({message:"no response"})},5e3);await this.pubsubclient.subscribe(e,s=>{clearTimeout(r);let n=JSON.parse(s);this.pubsubclient.unsubscribe(e),t(n)})})}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41692:e=>{"use strict";e.exports=require("node:tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47024:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>x,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{GET:()=>p});var n=s(48106),i=s(48819),a=s(12050),u=s(10368),o=s(4235),c=s(55511);async function p(e,{params:t}){let s=(await t).userId;if(!s)return o.NextResponse.json({message:"user id not valid"});let r=u.z.getInstance();await r.init();let n=(0,c.randomUUID)(),i=r.subscribeToEvent(n);await r.pushToEngine({userId:s},"GET_USER_STOCK_BALANCE",n);let a=await i;return o.NextResponse.json(a)}let l=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/user/balance/[userId]/route",pathname:"/api/user/balance/[userId]",filename:"route",bundlePath:"app/api/user/balance/[userId]/route"},resolvedPagePath:"/Users/divakarjaiswal/Developer/opinion/apps/client/app/api/user/balance/[userId]/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:d,workUnitAsyncStorage:b,serverHooks:x}=l;function h(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:b})}},55511:e=>{"use strict";e.exports=require("crypto")},58500:e=>{"use strict";e.exports=require("node:timers/promises")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73136:e=>{"use strict";e.exports=require("node:url")},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},80408:()=>{},87032:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[986,97,744],()=>s(47024));module.exports=r})();